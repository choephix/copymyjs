---
import { Copy } from 'lucide-astro';
import { Code } from 'astro:components';

interface Props {
  file: string;
}

const { file } = Astro.props;

// Import all snippet files
const snippetFiles = import.meta.glob<string>('/src/snippets/**/*.ts', {
  query: '?raw',
  import: 'default',
});
const filePath = `/src/snippets/${file}`;

let code = '';
if (filePath in snippetFiles) {
  code = await snippetFiles[filePath]();
} else {
  code = 'File not found';
}
---

<div class='snippet-container relative group'>
  <button
    class='copy-button absolute top-3 right-3 p-2 rounded-lg bg-gray-800/50 hover:bg-gray-700/50 opacity-0 group-hover:opacity-100 transition-opacity'
    aria-label='Copy code'
    data-code={code}
  >
    <Copy class='w-5 h-5 text-gray-400' />
  </button>
  <!-- <Code code={code} lang='ts' theme='tokyo-night' />
  <Code code={code} lang='ts' theme='houston' /> -->
  <Code code={code} lang='ts' theme='material-theme-ocean' />
  <!-- <Code code={code} lang='ts' theme='github-dark-default' /> -->
</div>

<style>
  .snippet-container {
    margin: 1rem 0;
    border-radius: 0.5rem;
    background: #1a1a1a;
    overflow: hidden;
  }

  .snippet-container pre {
    margin: 0;
    padding: 1rem;
    background: transparent;
    border: none;
  }

  /* Override any conflicting styles from prose class */
  :global(.prose .snippet-container pre) {
    margin: 0;
    padding: 1rem;
    background: transparent;
    border: none;
  }
</style>

<script>
  document.querySelectorAll('.copy-button').forEach(button => {
    button.addEventListener('click', async () => {
      const code = button.getAttribute('data-code');
      if (code) {
        await navigator.clipboard.writeText(code);

        // Visual feedback
        const icon = button.querySelector('svg');
        if (icon) {
          icon.classList.add('text-green-400');
          setTimeout(() => {
            icon.classList.remove('text-green-400');
          }, 1000);
        }
      }
    });
  });
</script>
